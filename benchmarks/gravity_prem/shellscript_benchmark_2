#!/bin/bash

rm inputfile.prm
rm *.ascii
rm -r output
rm opla_*
rm gravity_res*
rm statistics_res*

for GMR in 1 2 3 4 ; do
    for nqextra in 0 1 2 3 4 5 6 7 ; do

        cp benchmark_2.prm inputfile.prm 

        echo ===========================================================
        echo GMR=$GMR nqextra=$nqextra

        echo set Output directory = output >> inputfile.prm

        echo subsection Mesh refinement >> inputfile.prm
        echo set Initial global refinement            = ${GMR} >> inputfile.prm
        echo set Initial adaptive refinement          = 0 >> inputfile.prm
        echo set Skip solvers on initial refinement   = true >> inputfile.prm
        echo set Skip setup initial conditions on initial refinement = true >> inputfile.prm
        echo end >> inputfile.prm

        echo subsection Postprocess >> inputfile.prm
        echo set List of postprocessors = basic statistics, material statistics, gravity calculation >> inputfile.prm
        echo subsection Gravity calculation >> inputfile.prm
        echo set Quadrature degree increase  = ${nqextra} >> inputfile.prm
        echo set Reference density           = 3000 >> inputfile.prm

        # Parameters profile
        echo set Reference density           = 0 >> inputfile.prm
        echo set Sampling scheme             = map >> inputfile.prm
        echo set Minimum radius              = 0   >> inputfile.prm
        echo set Maximum radius              = 15000000 >> inputfile.prm
        echo set Number points radius        = 151 >> inputfile.prm
        echo set Minimum longitude           = 115 >> inputfile.prm
        echo set Maximum longitude           = 115 >> inputfile.prm
        echo set Number points longitude     = 1   >> inputfile.prm
        echo set Minimum latitude            = 87  >> inputfile.prm
        echo set Maximum latitude            = 87  >> inputfile.prm
        echo set Number points latitude      = 1   >> inputfile.prm

        # Parameters map 
        #echo set Sampling scheme             = map >> inputfile.prm
        #echo set Minimum radius              = 6596000 >> inputfile.prm
        #echo set Number points radius        = 1 >> inputfile.prm
        #echo set Number points longitude     = 73   >> inputfile.prm
        #echo set Number points latitude      = 37   >> inputfile.prm
        
        # Parameters fibonacci spiral 
        #echo set Sampling scheme                = fibonacci spiral >> inputfile.prm
        #echo set Number points fibonacci spiral = 2701 >> inputfile.prm
        #echo set Minimum radius                 = 6596000 >> inputfile.prm
        #echo set Number points radius           = 1    >> inputfile.prm

        echo end >> inputfile.prm
        echo end >> inputfile.prm

        ./aspect inputfile.prm >> opla__${GMR}_${nqextra}

        # rename files
        mv output/output_gravity/gravity-00000     gravity_${GMR}_${nqextra}.ascii
        mv output/statistics                       statistics_${GMR}_${nqextra}.ascii

        rm inputfile.prm

    done 
done 

cat gravity_*.ascii > profile_gravity_results
sed -i '/^#/d' profile_gravity_results
sed -i '/^$/d' profile_gravity_results
cat statistics_*.ascii > profile_statistics_results
sed -i '/^#/d' profile_statistics_results
sed -i '/^$/d' profile_statistics_results

#cat gravity_*.ascii > map_gravity_results
#sed -i '/^#/d' map_gravity_results
#sed -i '/^$/d' map_gravity_results
#cat statistics_*.ascii > map_statistics_results
#sed -i '/^#/d' map_statistics_results
#sed -i '/^$/d' map_statistics_results

#cat gravity_*.ascii > spiral_gravity_results
#sed -i '/^#/d' spiral_gravity_results
#sed -i '/^$/d' spiral_gravity_results
#cat statistics_*.ascii > spiral_statistics_results
#sed -i '/^#/d' spiral_statistics_results
#sed -i '/^$/d' spiral_statistics_results
